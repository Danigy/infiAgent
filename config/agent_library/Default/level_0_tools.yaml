tools:
  # ==================== File Operation Tools ====================
  
  file_read:
    level: 0
    type: tool_call_agent
    name: "file_read"
    description: "Read the content of specified files. Can read single or multiple files. Can read entire files or specify start and end lines. Returns JSON format with line numbers by default. Warning: Do not read binary files (e.g., pdf, docx, images, etc.)."
    parameters:
      type: "object"
      properties:
        path:
          type: "array"
          items:
            type: "string"
          description: "Array of file paths. Use ['file.txt'] for a single file, ['file1.txt', 'file2.txt'] for multiple files. Only text files are allowed; do not read binary files."
        start_line:
          type: "integer"
          description: "Starting line number to read (1-indexed), optional. Applies to all files in multi-file mode."
        end_line:
          type: "integer"
          description: "Ending line number to read (inclusive), optional. Applies to all files in multi-file mode."
        encoding:
          type: "string"
          description: "File encoding, optional. Automatically detected if not specified."
        show_line_numbers:
          type: "boolean"
          default: true
          description: "Whether to show line numbers. True returns JSON format (with line numbers), false returns plain text. Default is true."
      required: ["path"]

  file_write:
    level: 0
    type: tool_call_agent
    name: "file_write"
    description: "Write content to a specified file. If the file does not exist, it will be created automatically. If it exists, you can choose to overwrite or append. Also supports replacing specified lines. Note: Writing to the 'reference.bib' file is prohibited; please use the specialized reference management tools (reference_add/reference_delete)."
    parameters:
      type: "object"
      properties:
        path:
          type: "string"
          description: "Relative path of the file, e.g., 'src/main.py'. Before writing, it is recommended to use the directory listing tool to check for files with the same name to avoid overwriting others' files. The path 'reference.bib' is prohibited."
        content:
          type: "string"
          description: "The text content to write."
        mode:
          type: "string"
          enum: ["write", "append"]
          default: "write"
          description: "Write mode. 'write' overwrites the entire file, 'append' adds to the end of the file."
        start_line:
          type: "integer"
          description: "Line replacement mode - starting line number (1-indexed), optional."
        end_line:
          type: "integer"
          description: "Line replacement mode - ending line number, optional."
      required: ["path", "content"]
  
  dir_list:
    level: 0
    type: tool_call_agent
    name: "dir_list"
    description: "List the contents of a specified directory. Can recursively list all subdirectories and files (automatically excludes the 'code_env' directory)."
    parameters:
      type: "object"
      properties:
        path:
          type: "string"
          default: "."
          description: "Path of the directory to list. Lists the task root directory if not specified."
        recursive:
          type: "boolean"
          default: false
          description: "Whether to recursively list subdirectories, default is false."
      required: []

  dir_create:
    level: 0
    type: tool_call_agent
    name: "dir_create"
    description: "Create a new directory. Parent directories will be created automatically if they do not exist."
    parameters:
      type: "object"
      properties:
        path:
          type: "string"
          description: "Path of the directory to create."
      required: ["path"]

  file_move:
    level: 0
    type: tool_call_agent
    name: "file_move"
    description: "Move or copy files/directories. Can choose between moving or copying (preserving the original file)."
    parameters:
      type: "object"
      properties:
        source:
          type: "array"
          items:
            type: "string"
          description: "Array of relative paths for the source file(s) or directory(ies); can be single or multiple."
        destination:
          type: "string"
          description: "Target path."
        copy:
          type: "boolean"
          default: false
          description: "Whether to copy (preserve original file); default is false (move)."
      required: ["source", "destination"]

  file_delete:
    level: 0
    type: tool_call_agent
    name: "file_delete"
    description: "Delete the specified file or directory."
    parameters:
      type: "object"
      properties:
        path:
          type: "string"
          description: "Relative path of the file or directory to delete."
      required: ["path"]

  # ==================== Network Tools ====================

  web_search:
    level: 0
    type: tool_call_agent
    name: "web_search"
    description: "Perform web searches using DuckDuckGo. Results are saved in Markdown format."
    parameters:
      type: "object"
      properties:
        query:
          type: "string"
          description: "Search keywords or question."
        max_results:
          type: "integer"
          default: 10
          description: "Maximum number of results to return, default is 10."
        save_path:
          type: "string"
          description: "Relative path to save search results (.md file). Please save in the temp/web_search directory."
      required: ["query","save_path"]

  google_scholar_search:
    level: 0
    type: tool_call_agent
    name: "google_scholar_search"
    description: "Search for academic papers on Google Scholar. Supports year filtering and pagination. Search results are saved as a Markdown file."
    parameters:
      type: "object"
      properties:
        query:
          type: "string"
          description: "Search keywords or topic."
        year_low:
          type: "integer"
          description: "Starting year for filtering papers, optional."
        year_high:
          type: "integer"
          description: "Ending year for filtering papers, optional."
        pages:
          type: "integer"
          default: 1
          description: "Number of search result pages to crawl, approximately 10 papers per page."
        save_path:
          type: "string"
          description: "Relative path to save search results (.md file). Please save in the temp/scholar_search directory."
      required: ["query","save_path"]

  arxiv_search:
    level: 0
    type: tool_call_agent
    name: "arxiv_search"
    description: "Search the arXiv preprint repository. Returns paper title, author, abstract, PDF download link, and other information."
    parameters:
      type: "object"
      properties:
        query:
          type: "string"
          description: "Search keywords, e.g., 'transformer neural network'."
        max_results:
          type: "integer"
          default: 10
          description: "Maximum number of results to return, default is 10."
        sort_by:
          type: "string"
          enum: ["relevance", "lastUpdatedDate", "submittedDate"]
          default: "relevance"
          description: "Sorting method: relevance, lastUpdatedDate (update time), submittedDate (submission time)."
        sort_order:
          type: "string"
          enum: ["descending", "ascending"]
          default: "descending"
          description: "Sort order: descending, ascending."
        save_path:
          type: "string"
          description: "Relative path to save search results (.md file). Please save in the temp/arxiv_search directory."
      required: ["query","save_path"]

  crawl_page:
    level: 0
    type: tool_call_agent
    name: "crawl_page"
    description: "Crawl the content of a specified URL and convert it to Markdown format. Uses crawl4ai for intelligent extraction."
    parameters:
      type: "object"
      properties:
        url:
          type: "string"
          description: "Complete URL of the webpage to crawl."
        save_path:
          type: "string"
          description: "Relative path to save the Markdown file, required. If not specified, the content is returned directly. Please save in the temp/crawl_page directory."
        download_images:
          type: "boolean"
          default: false
          description: "Whether to download images; default is false (images are removed)."
      required: ["url","save_path"]

  file_download:
    level: 0
    type: tool_call_agent
    name: "file_download"
    description: "Download a file from a URL to the local system."
    parameters:
      type: "object"
      properties:
        url:
          type: "string"
          description: "URL of the file to download."
        save_path:
          type: "string"
          description: "Relative path to save the file, e.g., 'upload/file.pdf'."
      required: ["url", "save_path"]

  # ==================== Reference Management Tools ====================

  reference_list:
    level: 0
    type: tool_call_agent
    name: "reference_list"
    description: "List all references in the reference.bib file (displaying the original text)."
    parameters:
      type: "object"
      properties:
        bib_path:
          type: "string"
          default: "reference.bib"
          description: "Relative path of the .bib file, default is 'reference.bib'."
      required: []

  reference_add:
    level: 0
    type: tool_call_agent
    name: "reference_add"
    description: "Add references to the reference.bib file. If a citation key already exists, it will overwrite the existing content."
    parameters:
      type: "object"
      properties:
        entries:
          type: "array"
          items:
            type: "string"
          description: "Array of reference strings, each being a complete bib entry. E.g., ['@article{key1,...}', '@book{key2,...}']"
        bib_path:
          type: "string"
          default: "reference.bib"
          description: "Relative path of the .bib file, default is 'reference.bib'."
      required: ["entries"]

  reference_delete:
    level: 0
    type: tool_call_agent
    name: "reference_delete"
    description: "Delete specified references from the reference.bib file."
    parameters:
      type: "object"
      properties:
        keys:
          type: "array"
          items:
            type: "string"
          description: "Citation key(s) to delete (e.g., 'sun2023blockchain') or an array of citation keys."
        bib_path:
          type: "string"
          default: "reference.bib"
          description: "Relative path of the .bib file, default is 'reference.bib'."
      required: ["keys"]

  # ==================== Document Processing Tools ====================

  parse_document:
    level: 0
    type: tool_call_agent
    name: "parse_document"
    description: "Parse binary documents into plain text files; does not provide summarization or analysis services. Supports PDF, Word, and Markdown formats."
    parameters:
      type: "object"
      properties:
        path:
          type: "string"
          description: "Relative path of the document to parse."
        save_path:
          type: "string"
          description: "Relative path to save the parsed results. Please save in the temp/parse_document directory."
      required: ["path","save_path"]

  vision_tool:
    level: 0
    type: tool_call_agent
    name: "vision_tool"
    description: "Analyze image content using an LLM Vision model. Can identify content in images, describe scenes, answer questions, etc."
    parameters:
      type: "object"
      properties:
        image_path:
          type: "string"
          description: "Relative path of the image file (relative to the task directory)."
        question:
          type: "string"
          description: "Question to ask, e.g., 'What is this?' or 'Please describe the content of the image.' Defaults to describing the image content if not specified."
        save_path:
          type: "string"
          description: "Required, relative path to save the result. Please save in the temp/answer_figures directory."
      required: ["image_path","save_path"]

  create_image:
    level: 0
    type: tool_call_agent
    name: "create_image"
    description: "Generate an image based on a prompt and save it to a specified path."
    parameters:
      type: "object"
      properties:
        prompt:
          type: "string"
          description: "Description prompt for the image."
        image_path:
          type: "string"
          description: "Relative path to save the generated image (e.g., 'upload/generated_image.png')."
      required: ["prompt", "image_path"]

  audio_tool:
    level: 0
    type: tool_call_agent
    name: "audio_tool"
    description: "Analyze audio content using an LLM Audio model. Can identify content in audio, describe scenes, answer questions, etc. Supports mp3, wav, m4a, and other formats."
    parameters:
      type: "object"
      properties:
        audio_path:
          type: "string"
          description: "Relative path of the audio file (relative to the task directory)."
        question:
          type: "string"
          description: "Question to ask, e.g., 'What is discussed in this audio?' or 'Please describe the audio content.' Defaults to describing the audio content if not specified."
        model:
          type: "string"
          description: "Name of the model to use, optional. Uses the configured default model if not specified."
      required: ["audio_path"]

  paper_analyze_tool:
    level: 0
    type: tool_call_agent
    name: "paper_analyze_tool"
    description: "Parse academic papers and analyze their content using an LLM. Can summarize papers, answer questions about papers, etc."
    parameters:
      type: "object"
      properties:
        paper_path:
          type: "string"
          description: "Relative path of the paper file (relative to the task directory). Supports PDF, Word, and other formats."
        question:
          type: "string"
          description: "Question to ask, e.g., 'What are the main contributions of this paper?' Defaults to summarizing the paper if not specified."
        parse_save_path:
          type: "string"
          description: "Relative path to save the parsed results, optional."
      required: ["paper_path"]

  md_to_pdf:
    level: 0
    type: tool_call_agent
    name: "md_to_pdf"
    description: "Convert a Markdown file to PDF. Supports mathematical formulas, tables, and Chinese characters. Calls a remote Pandoc API service."
    parameters:
      type: "object"
      properties:
        source_path:
          type: "string"
          description: "Relative path of the source Markdown file."
        output_path:
          type: "string"
          description: "Relative path for the output PDF file, optional. If not specified, uses the source filename with the extension changed."
        engine:
          type: "string"
          enum: ["pdflatex", "xelatex", "lualatex"]
          default: "xelatex"
          description: "PDF compilation engine. xelatex supports Chinese (recommended), pdflatex is suitable for English."
      required: ["source_path"]

  md_to_docx:
    level: 0
    type: tool_call_agent
    name: "md_to_docx"
    description: "Convert a Markdown file to a Word document (.docx). Calls a remote Pandoc API service."
    parameters:
      type: "object"
      properties:
        source_path:
          type: "string"
          description: "Relative path of the source Markdown file."
        output_path:
          type: "string"
          description: "Relative path for the output DOCX file, optional. If not specified, uses the source filename with the extension changed."
      required: ["source_path"]

  # Note: 'file_download' is defined again here; the earlier definition in Network Tools takes precedence.
  # ==================== Human Interaction Tools ====================

  human_in_loop:
    level: 0
    type: tool_call_agent
    name: "human_in_loop"
    description: "Create a human task and wait for completion. Used for scenarios requiring human intervention (e.g., file upload, result confirmation) or for interacting with the user. Asynchronous and does not block the server."
    parameters:
      type: "object"
      properties:
        hil_id:
          type: "string"
          description: "Unique ID for the human task, used for subsequent queries and task completion."
        instruction:
          type: "string"
          description: "Instruction description for the human task."
      required: ["hil_id", "instruction"]

  # ==================== Code Execution Tools ====================

  execute_code:
    level: 0
    type: tool_call_agent
    name: "execute_code"
    description: "Execute Python code in the task's isolated virtual environment. Supports direct execution (blocking wait for results) and background execution (non-blocking, suitable for long-running code like web servers)."
    parameters:
      type: "object"
      properties:
        file_path:
          type: "string"
          description: "Relative path of the code file to execute (relative to the root directory), optional. Either code or file_path must be provided."
        working_dir:
          type: "string"
          default: "code_run"
          description: "Working directory for code execution, default is 'code_run'."
        use_venv:
          type: "boolean"
          default: true
          description: "Whether to use a virtual environment; default is true."
        timeout:
          type: "integer"
          default: 30
          description: "Execution timeout in seconds, default is 30. This parameter is invalid for background execution."
        background:
          type: "boolean"
          default: false
          description: "Whether to execute in the background (non-blocking). Suitable for long-running code (e.g., web servers). An output_file must be specified for background execution."
        output_file:
          type: "string"
          description: "Relative path to redirect output to a file. Required for background execution; optional for direct execution."
      required: ["file_path"]

  pip_install:
    level: 0
    type: tool_call_agent
    name: "pip_install"
    description: "Install one or more Python packages in the task's virtual environment. If the virtual environment does not exist, it will be created automatically."
    parameters:
      type: "object"
      properties:
        packages:
          type: "array"
          description: "List of Python package names to install, e.g., ['numpy', 'pandas']. Can also be a single string."
          items:
            type: "string"
        timeout:
          type: "integer"
          default: 300
          description: "Installation timeout in seconds, default is 300."
      required: ["packages"]

  execute_command:
    level: 0
    type: tool_call_agent
    name: "execute_command"
    description: "Execute a specified command-line command (only read-only commands like ls, cat, grep, pwd are allowed; dangerous operations like deletion or modification are prohibited). Can specify a working directory."
    parameters:
      type: "object"
      properties:
        command:
          type: "string"
          description: "Shell command to execute, e.g., 'ls -la' or 'pwd'. Only commands on the whitelist are allowed."
        working_dir:
          type: "string"
          default: "."
          description: "Relative path of the working directory for command execution, defaults to the task root directory."
        timeout:
          type: "integer"
          default: 30
          description: "Command execution timeout in seconds, default is 30."
      required: ["command"]

  grep:
    level: 0
    type: tool_call_agent
    name: "grep"
    description: "Search for matching text patterns in files (cross-platform pure Python implementation, supports regular expressions). Can search specified directories or files, supports recursive search and file type filtering."
    parameters:
      type: "object"
      properties:
        pattern:
          type: "string"
          description: "Regular expression pattern to search for, e.g., 'def.*function' or 'TODO'."
        search_path:
          type: "string"
          default: "."
          description: "Relative path to search, defaults to the current workspace root directory."
        file_pattern:
          type: "string"
          default: "*"
          description: "Filename matching pattern (supports wildcards), e.g., '*.py', '*.txt', '*.md'. Default matches all files."
        recursive:
          type: "boolean"
          default: true
          description: "Whether to recursively search subdirectories; default is true."
        case_sensitive:
          type: "boolean"
          default: true
          description: "Whether the search is case-sensitive; default is true."
        show_line_number:
          type: "boolean"
          default: true
          description: "Whether to show line numbers; default is true."
        max_results:
          type: "integer"
          default: 100
          description: "Maximum number of results; default is 100."
        context_lines:
          type: "integer"
          default: 0
          description: "Number of context lines to show before and after the matching line; default is 0 (no context)."
      required: ["pattern"]

  manage_code_process:
    level: 0
    type: tool_call_agent
    name: "manage_code_process"
    description: "Manage background code execution processes. Can list all background processes in the current workspace or terminate a specified background process. Used in conjunction with execute_code(background=True)."
    parameters:
      type: "object"
      properties:
        action:
          type: "string"
          enum: ["list", "kill"]
          description: "Type of action: 'list' to list background processes, 'kill' to terminate a specified process."
        process_id:
          type: "string"
          description: "Process ID to terminate (required only when action='kill'). Obtain from the output of a list action."
      required: ["action"]

  # ==================== Framework Essential Tools ====================

  final_output:
    level: 0
    type: tool_call_agent
    name: "final_output"
    description: "Tool for the agent to output final results. This tool is called when the agent completes a task or needs to terminate execution."
    parameters:
      type: "object"
      properties:
        task_id:
          type: "string"
          description: "Unique ID of the task."
        status:
          type: "string"
          enum: ["success", "error"]
          description: "Task execution status: 'success' indicates successful completion, 'error' indicates execution failure."
        output:
          type: "string"
          description: "Explanation of success or failure. If the output includes files, the relative paths and descriptions must be provided (do not repeat content already in the files), and include the judge agent's feedback."
        error_information:
          type: "string"
          description: "Error information, required only when status is 'error'."
      required: ["task_id", "status", "output"]